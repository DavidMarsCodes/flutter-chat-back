require('dotenv').config()
var aws = require('aws-sdk');
const Profile = require('../models/profile');

const fs = require('fs');

const uploadAvatar = async (req, res = response ) => {

   
    console.log("file name", req.files);  

    try {
   

    const S3_BUCKET = process.env.Bucket;
  
    const s3 = new AWS.S3({ apiVersion: '2006-03-01' });
    const fileName = req.files.file.name;
    const fileType = req.files.file.mimetype;
    //const fileName = String(Date.now()) + '.' + fileType;
    const folder = 'avatar';
    const buffer = req.files.file.data;


    var base64data = 'data:image/jpeg;base64,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';

    
    const s3Params = {
        Bucket: S3_BUCKET + '/' + folder,
        Key: fileName,
        Expires: 500,
        Body: base64data,
        ContentType: fileType,
       ACL: 'public-read'
    };

    console.log('s3Params', s3Params);

        s3.getSignedUrl('putObject', s3Params, (err, data) => {
        
        if (err) {
            console.log(err);
            res.json({ success: false, error: err })
        }

        const returnData = {
            signedRequest: data,
            url: `https://${S3_BUCKET}.s3.amazonaws.com/${folder}/${fileName}`
        };

        console.log(returnData)

/*         Profile.updateOne(
            {
                user: uid
            },
            {
                $set: {
                    imageAvatar: name,
              
                    

                }
            }
        );



        console.log('profileUpdate', profileUpdate) */

        res.json({ ok: true, data: { returnData } });

    });

        
    } catch (error) {
        
    }

}

module.exports = {
    uploadAvatar
}